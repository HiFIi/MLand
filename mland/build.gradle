apply plugin: 'com.android.application'
apply plugin: 'org.fabiomsr.drawableoptimizer'
apply plugin: 'com.github.sherter.google-java-format'
apply plugin: 'com.getkeepsafe.dexcount'

static def buildTime() {
    return new Date().format("yyyy-MM-dd", TimeZone.getTimeZone("UTC"))
}

android {
    compileSdkVersion 26
    buildToolsVersion "26.0.1"

    defaultConfig {
        applicationId "com.kyler.mland.egg"
        minSdkVersion 21
        maxSdkVersion 26
        targetSdkVersion 26
        versionCode 200
        versionName "2.0.0-wip"
        // Enabling multidex support.
        multiDexEnabled true
        
         resValue "string", "build_time", buildTime()
        
        flavorDimensions "target", "abi"

        lintOptions {
            checkReleaseBuilds false
            abortOnError false
        }
        
             productFlavors {
     regular {
            dimension "target"
            versionCode = 1
        }

        ARMv7 {
            dimension "abi"
            versionCode = 3
        }
        ARMv8 {
            dimension "abi"
            versionCode = 4
        }
    }
        
//Split into platform dependent APK
splits {
  abi {
    enable true
    reset()
    include 'armeabi', 'armeabi-v7a', 'arm64-v8a', 'mips', 'x86' //select ABIs to build APKs for
    universalApk false //generate an additional APK that contains all the ABIs
  }
}

// map for the version code
project.ext.versionCodes = ['armeabi': 1, 'armeabi-v7a': 2, 'arm64-v8a': 3, 'mips': 5, 'x86': 8]

// Rename with proper versioning
android.applicationVariants.all { variant ->
  // assign different version code for each output
  variant.outputs.each { output ->
    output.versionCodeOverride =
        project.ext.versionCodes.get(output.getFilter(com.android.build.OutputFile.ABI), 0) *
            1000000 +
            android.defaultConfig.versionCode
  }
}
  
  dexcount {
    format = "list"
    includeClasses = false
    includeClassCount = false
    includeFieldCount = true
    includeTotalMethodCount = false
    orderByMethodCount = false
    verbose = true
    maxTreeDepth = Integer.MAX_VALUE
    teamCityIntegration = false
    teamCitySlug = null
    runOnEachPackage = true
    maxMethodCount = 64000
}
  
      jackOptions {
    enabled true
    additionalParameters("jack.dex.debug.lines": "true")
    additionalParameters("jack.dex.debug.source": "true")
}

        googleJavaFormat {
            options style: 'GOOGLE'
        }

        drawableOptimizer {
            optimizer = 'zopfli'
            compressionLevel = 9
            iterations = 15
            onlyOnRelease = false
            logLevel = 'info'
        }

        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"

        dexOptions {
            preDexLibraries true
            maxProcessCount 8
            jumboMode = true
        }
    }
    
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    
    dataBinding {
        enabled = true
    }
  
    dexOptions {
        javaMaxHeapSize '4096m'
        preDexLibraries true
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
        buildTypes {
            debug {
        applicationIdSuffix ".debug"
                debuggable true
                minifyEnabled true
                shrinkResources true
                zipAlignEnabled true
                proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            }
        }
    }
}

repositories {
    flatDir {
        dirs 'libs'
    }
}

dependencies {
    compile fileTree(include: ['*.jar'], dir: 'libs')
    //noinspection GradleDynamicVersion
    compile 'com.android.support:appcompat-v7:+'
    //noinspection GradleDynamicVersion
    compile 'com.android.support:design:+'
    //noinspection GradleDynamicVersion
    testCompile 'junit:junit:+'
    //noinspection GradleDynamicVersion
    compile 'com.android.support:support-v4:+'
    //noinspection GradleDynamicVersion
    compile 'com.android.support:multidex:+'
    //noinspection GradleDynamicVersion
    debugCompile 'com.squareup.leakcanary:leakcanary-android:+'
    //noinspection GradleDynamicVersion
    releaseCompile 'com.squareup.leakcanary:leakcanary-android-no-op:+'
}
